(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const c of t)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(t){const c={};return t.integrity&&(c.integrity=t.integrity),t.referrerpolicy&&(c.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?c.credentials="include":t.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(t){if(t.ep)return;t.ep=!0;const c=o(t);fetch(t.href,c)}})();const E=document.querySelector(".cart__address"),x=document.querySelector(".cep-input"),O=async e=>{const r=`https://cep.awesomeapi.com.br/json/${e}`,o=`https://brasilapi.com.br/api/cep/v2/${e}`;try{const t=await(await Promise.any([fetch(o),fetch(r)])).json();return console.log(t),t}catch{E.innerText="CEP n\xE3o encontrado"}},q=async()=>{const e=x.value,r=8;if(!Number(e)||e.length!==r)E.innerText="CEP n\xE3o encontrado";else{const o=await O(e);E.innerText=`${o.address||o.street} - ${o.district||o.neighborhood} - ${o.city} - ${o.state}`}};const p=async e=>{const r=`https://api.mercadolibre.com/items/${e}`;if(!e)throw new Error("ID n\xE3o informado");return await(await fetch(r)).json()},$=async e=>{const r=`https://api.mercadolibre.com/sites/MLB/search?q=${e}`;if(!e)throw new Error("Termo de busca n\xE3o informado");return(await(await fetch(r)).json()).results},d=()=>{const e=localStorage.getItem("cartProducts");return e?JSON.parse(e):[]},D=e=>{if(!e)throw new Error("Voc\xEA deve fornecer um ID");const o=[...d(),e];localStorage.setItem("cartProducts",JSON.stringify(o))},j=e=>{if(!e)throw new Error("Voc\xEA deve fornecer um ID");const r=[...d()],o=r.indexOf(e);r.splice(o,1),localStorage.setItem("cartProducts",JSON.stringify(r))},h=document.querySelector(".total-price"),v=e=>{const r=document.createElement("img");return r.className="product__image",r.src=e.replace("I.jpg","O.jpg"),r},s=(e,r,o="")=>{const n=document.createElement(e);return n.className=r,n.innerText=o,n},A=(e,r)=>{e.remove(),j(r)},I=({id:e,title:r,price:o,pictures:n})=>{const t=document.createElement("li");t.className="cart__product";const c=s("div","cart__product__image-container"),a=v(n[0].url);c.appendChild(a);const u=v((n[1]||n[0]).url);c.appendChild(u),t.appendChild(c);const l=s("div","cart__product__info-container");l.appendChild(s("span","product__title",r));const g=s("span","product__price","R$ ");g.appendChild(s("span","product__price__value",o)),l.appendChild(g),t.appendChild(l);const m=s("i","material-icons cart__product__remove","delete");return t.appendChild(m),t.addEventListener("click",async()=>{A(t,e);const _=d(),y=(await Promise.all(_.map(p))).reduce((C,P)=>C+P.price,0);h.innerText=y.toFixed(2)}),t},M=({id:e,title:r,thumbnail:o,price:n})=>{const t=document.createElement("section");t.className="product",t.appendChild(s("span","product__id",e));const c=s("div","img__container");c.appendChild(v(o)),t.appendChild(c),t.appendChild(s("span","product__title",r));const a=s("span","product__price","R$ ");a.appendChild(s("span","product__price__value",n)),t.appendChild(a);const u=s("button","product__add","Adicionar ao carrinho!");return t.appendChild(u),u.addEventListener("click",async l=>{const m=l.target.parentNode.firstChild.innerText,_=document.querySelector(".cart__products"),i=await p(m);console.log(i),D(i.id);const y={id:i.id,title:i.title,price:i.price,pictures:i.pictures},C=d(),L=(await Promise.all(C.map(p))).reduce((N,T)=>N+T.price,0);h.innerHTML=L.toFixed(2),console.log(h),localStorage.setItem("total-price",JSON.stringify(h));const b=I(y);return _.appendChild(b),m}),t};document.querySelector(".cep-button").addEventListener("click",q);const S=document.querySelector(".total-price"),f=document.querySelector(".products"),w=document.createElement("p");w.innerHTML='<p class="loading">carregando...</p>';f.appendChild(w);const F=async()=>{try{const e=await $("computador");f.removeChild(w),e.forEach(r=>{const{id:o,title:n,thumbnail:t,price:c}=r,a=M({id:o,title:n,thumbnail:t,price:c});f.appendChild(a)})}catch{const e=document.createElement("p");e.innerText="Algum erro ocorreu, recarregue a p\xE1gina e tente novamente",e.className="error",f.appendChild(e)}};async function J(){const e=d(),o=(await Promise.all(e.map(p))).reduce((n,t)=>n+t.price,0);S.innerHTML=o.toFixed(2),console.log(S)}async function k(){const e=d();J();const r=e.map(c=>p(c)),o=await Promise.allSettled(r),n=document.querySelector(".cart__products");return o.forEach(c=>{n.appendChild(I(c.value))})}window.onload=async()=>{await F(),k()};
